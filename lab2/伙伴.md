<<<<<<< HEAD
#伙伴系统算法设计文档
伙伴算法（Buddy system）把所有的空闲页框分为11个块链表，每块链表中分布包含特定的连续页框地址空间，比如第0个块链表包含大小为2^0 ^个连续的页框，第1个块链表中，每个链表元素包含2个页框大小的连续地址空间，….，第10个块链表中，每个链表元素代表4M的连续地址空间。每个链表中元素的个数在系统初始化时决定，在执行过程中，动态变化。伙伴算法每次只能分配2的幂次页的空间，比如一次分配1页，2页，4页，8页，…，1024页等等，每页大小一般为4K，因此，伙伴算法最多一次能够分配4M的内存空间。

##内存分配
伙伴分配器分配和释放内存的基本单位是阶（order）。
分配函数为buddy_alloc_pages(size_t n)。传入参数n后首先判断需要几阶空闲页块，判断是否超过最大阶数，若超过，返回null，未超过则查看是否有n阶或n+1阶空闲页块，若有n阶则直接分配，否则将n+1阶拆为两个n阶页块，一个分配出去，一个添加到n阶页块中管理； 如果没有，则继续查找更高阶的页块。

##内存释放
内存释放调用函数buddy_free_pages(struct Page *base, size_t n)
=======
#伙伴系统算法设计文档
伙伴算法（Buddy system）把所有的空闲页框分为11个块链表，每块链表中分布包含特定的连续页框地址空间，比如第0个块链表包含大小为2^0 ^个连续的页框，第1个块链表中，每个链表元素包含2个页框大小的连续地址空间，….，第10个块链表中，每个链表元素代表4M的连续地址空间。每个链表中元素的个数在系统初始化时决定，在执行过程中，动态变化。伙伴算法每次只能分配2的幂次页的空间，比如一次分配1页，2页，4页，8页，…，1024页等等，每页大小一般为4K，因此，伙伴算法最多一次能够分配4M的内存空间。

##内存分配
伙伴分配器分配和释放内存的基本单位是阶（order）。
分配函数为buddy_alloc_pages(size_t n)。传入参数n后首先判断需要几阶空闲页块，判断是否超过最大阶数，若超过，返回null，未超过则查看是否有n阶或n+1阶空闲页块，若有n阶则直接分配，否则将n+1阶拆为两个n阶页块，一个分配出去，一个添加到n阶页块中管理； 如果没有，则继续查找更高阶的页块。

##内存释放
内存释放调用函数buddy_free_pages(struct Page *base, size_t n)
>>>>>>> 735b17d6b5c42ae6d19d016db8226e027daec8d6
释放之前首先检查页面是否已经被释放，防止多次释放。接着对释放的块进行检查，看伙伴块是否已经被使用或者地址是否越界，最后将释放后的最终块加入空闲链表，同时更新空闲块的数量。